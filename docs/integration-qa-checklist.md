# 통합 시나리오 테스트 / 로그 검증 / 회귀 체크리스트

## 1) 통합 시나리오 테스트 정의

### S1. 자동전투 중 상단 자원/스테이지 갱신
- **목적**: 자동전투 진행 시 상단 HUD(골드/보석/스테이지)가 실시간으로 갱신되는지 확인.
- **사전 조건**: `index.html` 실행 후 `UILayoutScene` 진입.
- **절차**
  1. 초기 골드/스테이지 값을 기록.
  2. 입력 없이 10~20초 대기.
  3. 골드 증가 및 스테이지 값 변화를 확인.
- **합격 기준**
  - 골드는 몬스터 처치 보상에 따라 증가한다.
  - 스테이지는 `progression.difficultyLevel` 값을 반영한다.

### S2. 전투/영웅 슬롯 UI 동시 노출
- **목적**: 중단 좌측 전투 패널과 우측 영웅 슬롯 패널이 동시에 표시되는지 확인.
- **절차**
  1. 화면 진입 즉시 중앙 영역 확인.
  2. 좌측 `전투 메인 화면`, 우측 `영웅 슬롯` 제목 및 구성요소를 확인.
- **합격 기준**
  - 좌/우 패널이 동시에 렌더링되어야 하며, 한쪽이 숨김되지 않아야 한다.

### S3. 하단 탭 전환 시 상태 유지
- **목적**: 탭 전환(업그레이드/퀘스트/상점) 중 핵심 상태가 유지되는지 확인.
- **절차**
  1. `업그레이드` 탭에서 슬롯 강화 1회 수행.
  2. `퀘스트` → `상점` → `업그레이드` 순으로 탭 이동.
  3. 강화 레벨/업그레이드 비용/골드가 이전 상태를 유지하는지 확인.
- **합격 기준**
  - `heroSlotLevel`, `heroUpgradeCost`, `gold`, `activeTab` 연동 UI가 기대대로 유지된다.

---

## 2) 로그 기능 검증 수행 결과

### 실행 커맨드
- `node scripts/validate-combat-log.mjs`

### 검증 항목 및 결과
- **버튼 토글 정상 동작**: `toggleLogPanel()`에서 `isLogPanelVisible`을 반전하고 패널 항목 가시성을 동기화.
- **F1 토글 정상 동작**: `keydown-F1` 입력에서 동일 토글 핸들러를 호출.
- **전투 이벤트 순차 기록**: 스크립트에서 타임스탬프 단조 증가/전투 상태 전환 페어(종료→시작, 처치→골드→스테이지)를 검증하여 통과.

---

## 3) 경계 케이스 점검 결과

### B1. 로그 대량 발생 시 성능
- **관찰**
  - `MAX_COMBAT_LOGS=200` 상한으로 이벤트 배열을 슬라이싱하여 메모리/렌더링 부하를 제한.
  - 200,000 tick 스트레스 시뮬레이션에서 로그 크기는 200으로 유지.
- **판정**: 상한 정책 덕분에 급격한 성능 저하 징후 없음.

### B2. 전투 상태 전환(승리/패배/재시작) 로그 정합성
- **관찰**
  - 처치 직후 `처치`→`골드획득`→`스테이지클리어` 순서 기록.
  - 플레이어 다운 시 `전투종료`→`전투시작` 순서 기록.
- **판정**: 시퀀스 정합성 검증 통과.

### B3. UI 리사이즈/해상도 변경 안정성
- **관찰**
  - 레이아웃 계산은 최소 `960x540` 보장 후 비율 기반 재생성.
  - resize 이벤트에서 패널 클리어 후 재생성 + 상태 재렌더링 수행.
- **판정**: 구조적으로 레이아웃 안정성 확보.

---

## 4) 회귀 체크리스트

- [ ] 기존 클릭 업그레이드 동작
  - 골드 부족 시 실패 메시지 출력
  - 골드 충분 시 공격력/최대HP 증가, 비용 증가
- [ ] 재화 획득 및 표시
  - 몬스터 처치 시 골드 증가
  - 보석(`killCount/15`) 표시 갱신
- [ ] 스테이지 진행 로직
  - `nextMonsterLevel()` 규칙에 따른 난이도 상승
  - 처치 후 다음 몬스터 스폰/표시 갱신

---

## 5) 발견 이슈 분류 및 재할당 목록 (Codex1/2)

### Critical
- 없음.

### High
1. **장기 플레이 로그 보존 한계**
   - 증상: 로그는 최근 200개만 유지되어 장기 세션에서 과거 이벤트 추적 불가.
   - 영향: 운영/QA에서 장시간 재현 로그 확보가 어려움.
   - 제안 담당: **Codex1** (로그 영속화/다운로드/필터링 전략 설계)

### Medium
1. **로그 검증 자동화가 로직 중심으로 제한됨**
   - 증상: 현재 검증은 core 로직 시뮬레이션 중심이며, 캔버스 UI 상호작용 E2E 자동화가 미흡.
   - 영향: 실제 UX 플로우 회귀를 완전 자동화하지 못함.
   - 제안 담당: **Codex2** (Phaser 씬 상태를 노출하는 테스트 훅 + E2E harness 구축)

2. **로그 패널 상태(열림/스크롤 위치) 영속화 미지원**
   - 증상: 세션 재시작 시 로그 패널 열림 상태/스크롤 컨텍스트 복원 불가.
   - 영향: 디버깅 컨텍스트 유지성 저하.
   - 제안 담당: **Codex2** (localStorage 기반 UI state persistence)

### Low
1. **탭 콘텐츠가 플레이스홀더 중심**
   - 증상: 퀘스트/상점 탭은 현재 안내 문구 중심.
   - 영향: 기능성 회귀 범위가 제한적.
   - 제안 담당: **Codex1** (탭별 최소 기능 스텁 추가)
